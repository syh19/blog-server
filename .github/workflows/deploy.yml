name: deploy-website  # 工作流名称

on:  # 触发条件
  push:  # push事件
    branches:  # 分支
      - main  # main分支
permissions:  # 权限
  contents: read # to fetch code (actions/checkout)
jobs:  # 工作流所包含的job
  build:  # 工作流所包含的其中一个job名称叫做build
    runs-on: ubuntu-latest  # 运行环境
    steps:  # 步骤
      - uses: actions/checkout@v3  # 拉取代码
      
      # 每个步骤都有一个名字
      - name: Set up Node.js  # 设置node环境
        uses: actions/setup-node@v3  # 使用actions/setup-node@v3
        with:  # 传递参数
          node-version: '16.17.0'  # node版本

      - name: Install dependencies  # 安装依赖
        run: npm install  # 执行npm install

      - name: Deploy with scp  # 部署
        uses: appleboy/scp-action@master
        with:
          host: ${{ secrets.REMOTE_HOST }}
          username: ${{ secrets.REMOTE_USERNAME }}
          password: ${{ secrets.REMOTE_PASSWORD }}
          port: 22
          source: "/"
          target: "/www/wwwroot/blog-server"
          strip_components: 1  # 去除根目录
          rm: false  # 删除原有文件

